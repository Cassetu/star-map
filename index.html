<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Equinox Line - V1.3.4</title>
    <link rel="icon" type="image/png" href="images/icon.png">
    <link href="style.css" rel="stylesheet"/>
</head>
<audio id="battle-music" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3" type="audio/mpeg">
</audio>
<audio id="victory-music">
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3" type="audio/mpeg">
</audio>
<audio id="sfx-city-build" preload="auto">
    <source src="https://cdn.pixabay.com/audio/2022/03/24/audio_3fb91eb9d4.mp3" type="audio/mpeg">
</audio>
<audio id="sfx-resource-gather" preload="auto">
    <source src="https://cdn.pixabay.com/audio/2025/04/18/audio_ad81e3ab85.mp3" type="audio/mpeg">
</audio>
<audio id="sfx-attack" preload="auto">
    <source src="https://cdn.pixabay.com/audio/2024/09/18/audio_52ea34712d.mp3" type="audio/mpeg">
</audio>
<audio id="sfx-explosion" preload="auto">
    <source src="https://freesound.org/data/previews/156/156031_2703579-lq.mp3" type="audio/mpeg">
</audio>
<audio id="sfx-alert" preload="auto">
    <source src="https://cdn.pixabay.com/audio/2024/02/07/audio_c059f11d86.mp3" type="audio/mpeg">
</audio>
<audio id="sfx-success" preload="auto">
    <source src="https://freesound.org/data/previews/270/270404_5123851-lq.mp3" type="audio/mpeg">
</audio>
<audio id="sfx-error" preload="auto">
    <source src="https://cdn.pixabay.com/audio/2022/11/21/audio_136661e554.mp3" type="audio/mpeg">
</audio>
<audio id="sfx-button-click" preload="auto">
    <source src="https://cdn.pixabay.com/audio/2025/06/01/audio_d2ccbb367a.mp3" type="audio/mpeg">
</audio>
<button id="music-btn"
        style="position: fixed; bottom: 20px; right: 200px; z-index: 10000; width: 50px; height: 50px; border-radius: 50%; background: rgba(0,0,0,0.7); border: 2px solid #00ff00; font-size: 24px; cursor: pointer;">
    üîä
</button>

<script src="audio.js"></script>
<script src="win.js"></script>
<script src="tree.js"></script>
<script src="wonders.js"></script>

<body>
<div id="minimap-container">
    <div id="minimap">
        <div class="minimap-viewport"></div>
    </div>
</div>

<div id="zoom-controls">
    <button id="zoom-in-btn">+</button>
    <button id="zoom-out-btn">‚àí</button>
</div>
<div id="game-container">
    <div id="header">
        <h1><img src="images/icon.png" alt="Equinox Line" style="width: 50px; height: 50px; vertical-align: middle; margin-right: 8px;">EQUINOX LINE</h1>
        <div id="stats">
            <div class="stat">
                <div class="stat-label">RESEARCH</div>
                <div class="stat-value" id="research-display">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">POPULATION</div>
                <div class="stat-value" id="total-pop">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">FOOD</div>
                <div class="stat-value" id="food-display">500</div>
            </div>
            <div class="stat">
                <div class="stat-label">METAL</div>
                <div class="stat-value" id="metal-display">300</div>
            </div>
            <div class="stat">
                <div class="stat-label">ENERGY</div>
                <div class="stat-value" id="energy-display">200</div>
            </div>
            <div class="stat">
                <div class="stat-label">INFANTRY</div>
                <div class="stat-value" id="infantry-display">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">CAVALRY</div>
                <div class="stat-value" id="cavalry-display">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">ARTILLERY</div>
                <div class="stat-value" id="artillery-display">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">TRIBAL REP</div>
                <div class="stat-value" id="tribal-rep">50</div>
            </div>
            <div class="stat">
                <div class="stat-label">YEAR</div>
                <div class="stat-value" id="year">0</div>
            </div>
        </div>
    </div>

    <div id="left-panel">
        <div class="panel-tabs">
            <div class="panel-tab active" data-tab="info">‚ÑπÔ∏è</div>
            <div class="panel-tab" data-tab="military">‚öîÔ∏è</div>
            <div class="panel-tab" data-tab="livestock">üêÑ</div>
            <div class="panel-tab" data-tab="laws">‚öñÔ∏è</div>
            <div class="panel-tab" data-tab="requests">üìã</div>
        </div>

        <div class="panel-content">
            <div class="tab-content active" id="info-tab">

                <div id="info-panel"></div>
            </div>

            <div class="tab-content" id="military-tab">
                <h3 style="color: #ffaa00; font-size: 14px; margin-bottom: 10px;">RECRUITMENT</h3>
                <p style="font-size: 10px; margin-bottom: 10px; opacity: 0.8;">Select a city first</p>

                <div class="unit-type">
                    <div class="unit-info">
                        <div class="unit-name">Infantry</div>
                        <div class="unit-stats">Atk:5 Def:3</div>
                    </div>
                </div>
                <button class="action-btn" id="recruit-infantry-btn" style="font-size: 10px; padding: 5px;">Recruit Infantry (50F, 50M, 50pop)</button>

                <div class="unit-type" style="margin-top: 6px;">
                    <div class="unit-info">
                        <div class="unit-name">Cavalry</div>
                        <div class="unit-stats">Atk:12 Def:5</div>
                    </div>
                </div>
                <button class="action-btn" id="recruit-cavalry-btn" style="font-size: 10px; padding: 5px;">Recruit Cavalry (100F, 100M, 50E, 100pop)</button>

                <div class="unit-type" style="margin-top: 6px;">
                    <div class="unit-info">
                        <div class="unit-name">Artillery</div>
                        <div class="unit-stats">Atk:20 Def:2</div>
                    </div>
                </div>
                <button class="action-btn" id="recruit-artillery-btn" style="font-size: 10px; padding: 5px;">Recruit Artillery (50F, 300M, 150E, 10pop)</button>
            </div>

            <div class="tab-content" id="livestock-tab">
                <h3 style="color: #8B4513; font-size: 14px; margin-bottom: 10px;">LIVESTOCK MANAGEMENT</h3>

                <div id="livestock-city-info" style="display: none;">
                    <div style="background: rgba(139,69,19,0.2); padding: 8px; border-radius: 5px; margin-bottom: 10px;">
                        <div style="font-size: 11px; font-weight: bold; margin-bottom: 5px;" id="livestock-city-name">City Name</div>
                        <div style="font-size: 9px;">Capacity: <span id="livestock-capacity">0</span></div>
                        <div style="font-size: 9px;">Total Animals: <span id="livestock-total">0</span></div>
                    </div>

                    <div id="livestock-breakdown" style="margin-bottom: 10px;"></div>

                    <div style="margin-top: 10px;">
                        <button class="action-btn" id="hire-herders-btn" style="font-size: 10px; padding: 5px; width: 100%;">Hire Herders (100F, 50M)</button>
                    </div>
                </div>

                <div id="livestock-no-city" style="text-align: center; padding: 20px; opacity: 0.7;">
                    <div style="font-size: 32px; margin-bottom: 10px;">üêÑ</div>
                    <p style="font-size: 11px;">Select a city to manage livestock</p>
                </div>

                <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid rgba(139,69,19,0.3);">
                    <h4 style="color: #8B4513; font-size: 12px; margin-bottom: 8px;">Global Market</h4>
                    <div id="livestock-market" style="font-size: 10px;"></div>
                </div>

                <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid rgba(139,69,19,0.3);">
                    <h4 style="color: #8B4513; font-size: 12px; margin-bottom: 8px;">Wild Herds</h4>
                    <div id="wild-herds-list" style="font-size: 10px;">
                        <p style="opacity: 0.7;">No wild herds spotted</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="laws-tab">
                <div style="text-align: center; margin-bottom: 15px;">
                    <button id="sfx-toggle-btn" style="width: 100%; padding: 8px; background: rgba(0, 255, 0, 0.2); border: 2px solid #00ff00;">
                        üîä SFX: ON
                    </button>
                </div>
                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleCollapsible('laws')">
                        <h4>CITY LAWS</h4>
                        <span class="collapsible-indicator" id="laws-indicator">‚ñº</span>
                    </div>
                    <div class="collapsible-content open" id="laws-content">
                        <p style="font-size: 10px; margin-bottom: 8px;"><strong>Current:</strong> <span id="current-law-name">No Special Laws</span></p>
                        <div id="laws-container">
                            <div class="law-option active" data-law="none">
                                <div class="law-title">No Special Laws</div>
                                <div class="law-effects">Balanced approach</div>
                            </div>
                            <div class="law-option" data-law="relaxed">
                                <div class="law-title">Relaxed Work</div>
                                <div class="law-effects">-20% res, +1 happiness/yr</div>
                            </div>
                            <div class="law-option" data-law="efficient">
                                <div class="law-title">Efficiency</div>
                                <div class="law-effects">+30% res, -0.5 happiness/yr</div>
                            </div>
                            <div class="law-option" data-law="productive">
                                <div class="law-title">Production+</div>
                                <div class="law-effects">+50% res, -1 happiness/yr</div>
                            </div>
                            <div class="law-option" data-law="harsh">
                                <div class="law-title">Harsh Labor</div>
                                <div class="law-effects">+100% res, -2 happiness/yr</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="requests-tab">
                    <h3 style="color: #9370DB; font-size: 14px; margin-bottom: 10px;">CITIZEN REQUESTS</h3>
                    <div id="active-request-container"></div>
                    <div id="no-request" style="text-align: center; padding: 20px; opacity: 0.7;">
                        <div style="font-size: 32px; margin-bottom: 10px;">üë•</div>
                        <p style="font-size: 11px;">No pending requests</p>
                        <p style="font-size: 9px; margin-top: 10px;">Citizens will occasionally ask for help</p>
                    </div>
                </div>

                <div class="collapsible-section">
                    <div class="collapsible-header" onclick="toggleCollapsible('philanthropy')">
                        <h4>PHILANTHROPY</h4>
                        <span class="collapsible-indicator" id="philanthropy-indicator">‚ñº</span>
                    </div>
                    <div class="collapsible-content open" id="philanthropy-content">
                        <p style="font-size: 10px; margin-bottom: 8px;">Boost all cities' happiness</p>
                        <button class="action-btn" id="charity-small-btn" style="font-size: 10px; padding: 5px;">Small Aid +5 (30F, 15M, 5E)</button>
                        <button class="action-btn" id="charity-medium-btn" style="font-size: 10px; padding: 5px;">Medium Aid +15 (90F, 45M, 15E)</button>
                        <button class="action-btn" id="charity-large-btn" style="font-size: 10px; padding: 5px;">Large Aid +35 (240F, 120M, 40E)</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="main-game">
        <div id="planet-view">
            <div class="terrain-layer" id="terrain-container"></div>
            <div id="habitable-zone"></div>
            <div class="city-radius" id="placement-radius"></div>
            <div class="placement-preview" id="placement-preview">
                <div class="placement-preview-icon"></div>
            </div>
        </div>
    </div>

    <div id="diplomacy-panel">
        <h3>Tribal Civilization</h3>
        <p id="tribal-status" style="font-size: 11px;">Status: Neutral</p>
        <div class="reputation-bar">
            <div class="reputation-fill" id="reputation-fill" style="width: 50%"></div>
            <div class="reputation-text" id="reputation-text">50/100</div>
        </div>
        <p style="font-size: 9px; margin: 8px 0;">Tribes expand every 10yr (road) / 30-40yr (city)</p>

        <div style="background: rgba(255,68,0,0.1); padding: 8px; border-radius: 5px; margin: 8px 0;">
        </div>

        <div class="diplomacy-actions">
            <button class="diplomacy-btn" id="trade-btn">Trade (80F‚Üí80M)</button>
            <button class="diplomacy-btn" id="embassy-btn">Embassy (200F, 200M, 100E)</button>
            <button class="diplomacy-btn" id="denounce-btn">Denounce (-30)</button>
            <button class="diplomacy-btn" id="declare-war-btn">War</button>
            <button class="diplomacy-btn" id="negotiate-peace-btn" style="display: none;">Negotiate Peace (1000)</button>
        </div>

        <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid rgba(255,136,0,0.3);">
            <h4 style="color: #8B4513; font-size: 12px; margin-bottom: 8px;">üêÑ Livestock Trade</h4>
            <p style="font-size: 9px; opacity: 0.7; margin-bottom: 8px;">Trade animals with tribals (Friendly+ relations)</p>
            <div id="tribal-livestock-trade"></div>
        </div>

        <p style="font-size: 8px; margin-top: 8px; opacity: 0.7;">
            <strong>Relations:</strong> 0-20: War | 21-40: Hostile | 41-60: Neutral | 61-80: Friendly | 81-100: Allied
        </p>

        <div id="messages" style="margin-top: 20px;"></div>

    </div>


    <div id="controls">
        <button id="gather-btn">Gather +5
            <div class="button-cooldown" id="gather-cooldown"></div>
        </button>
        <button id="build-city-btn">Place City (200F, 200M, 100E)</button>
        <button disabled id="build-road-btn">Build Road (100M, 50E)</button>
        <button id="spaceport-btn">Spaceport</button>
        <button id="pause-btn">Pause</button>
    </div>

    <div id="spaceport-panel">
        <h3>SPACEPORT PROJECT</h3>
        <p>Evacuate to a stable planet!</p>
        <p><strong>Requirements:</strong></p>
        <p>Population: <span id="sp-pop-current">0</span>/<span id="sp-pop-req">5000</span> | Resources: <span id="sp-res-current">0</span>: 4000F + 4000M + 4000E</p>

        <div class="progress-bar-container">
            <div class="progress-bar-fill" id="spaceport-progress-bar" style="width: 0%">0%</div>
        </div>
        <p style="font-size: 9px; opacity: 0.8;">Costs 4000F + 4000M + 4000E upfront. Takes 10 years to build. Pop must stay above 3500.</p>
        <button class="action-btn" id="start-spaceport-btn" style="font-size: 11px;">Start Construction</button>
    </div>

    <div id="battle-overlay">
        <div id="battle-container">
            <div id="battle-header">
                <div id="battle-timer">Time: 30s</div>
                <div id="battle-morale">Morale: 100%</div>
                <div id="weather-display"></div>
            </div>

            <div id="battlefield">
                <div id="player-side" class="army-side">
                    <div class="unit-group" data-type="infantry">
                        <div class="unit-icon-display"></div>
                        <div class="unit-health-bar"><div class="health-fill"></div></div>
                        <div class="unit-count">0</div>
                    </div>
                    <div class="unit-group" data-type="cavalry">
                        <div class="unit-icon-display"></div>
                        <div class="unit-health-bar"><div class="health-fill"></div></div>
                        <div class="unit-count">0</div>
                    </div>
                    <div class="unit-group" data-type="artillery">
                        <div class="unit-icon-display"></div>
                        <div class="unit-health-bar"><div class="health-fill"></div></div>
                        <div class="unit-count">0</div>
                    </div>
                </div>

                <div id="battle-middle">
                    <canvas id="battle-canvas"></canvas>
                </div>

                <div id="enemy-side" class="army-side">
                    <div class="unit-group" data-type="infantry">
                        <div class="unit-icon-display"></div>
                        <div class="unit-health-bar"><div class="health-fill"></div></div>
                        <div class="unit-count">0</div>
                    </div>
                    <div class="unit-group" data-type="cavalry">
                        <div class="unit-icon-display"></div>
                        <div class="unit-health-bar"><div class="health-fill"></div></div>
                        <div class="unit-count">0</div>
                    </div>
                    <div class="unit-group" data-type="artillery">
                        <div class="unit-icon-display"></div>
                        <div class="unit-health-bar"><div class="health-fill"></div></div>
                        <div class="unit-count">0</div>
                    </div>
                </div>
            </div>

            <div id="battle-controls">
                <div class="unit-commands" data-unit="infantry">
                    <div class="unit-label">Infantry</div>
                    <button class="cmd-btn" data-cmd="advance">‚¨ÜÔ∏è Advance</button>
                    <button class="cmd-btn" data-cmd="hold">üõ°Ô∏è Hold</button>
                    <button class="cmd-btn" data-cmd="focus">üéØ Focus</button>
                </div>
                <div class="unit-commands" data-unit="cavalry">
                    <div class="unit-label">Cavalry</div>
                    <button class="cmd-btn" data-cmd="advance">‚¨ÜÔ∏è Advance</button>
                    <button class="cmd-btn" data-cmd="hold">üõ°Ô∏è Hold</button>
                    <button class="cmd-btn" data-cmd="focus">üéØ Focus</button>
                </div>
                <div class="unit-commands" data-unit="artillery">
                    <div class="unit-label">Artillery</div>
                    <button class="cmd-btn" data-cmd="advance">‚¨ÜÔ∏è Advance</button>
                    <button class="cmd-btn" data-cmd="hold">üõ°Ô∏è Hold</button>
                    <button class="cmd-btn" data-cmd="focus">üéØ Focus</button>
                </div>
            </div>

            <div style="grid-column: 1 / -1; margin-top: 8px; padding-top: 8px; border-top: 2px solid #666;">
                <div style="text-align: center; font-size: 11px; font-weight: bold; color: #ffaa00; margin-bottom: 6px;">
                    PRIORITY TARGET
                </div>
                <div style="display: flex; gap: 6px; justify-content: center;">
                    <button class="target-btn" data-target="infantry">Target Infantry</button>
                    <button class="target-btn" data-target="cavalry">Target Cavalry</button>
                    <button class="target-btn" data-target="artillery">Target Artillery</button>
                    <button class="target-btn active" data-target="auto">Auto-Target</button>
                </div>
            </div>

            <div id="battle-actions">
                <button id="reinforcement-btn">Call Reinforcements (300 res)</button>
                <div id="perk-abilities"></div>
            </div>

            <div id="battle-log"></div>
        </div>
    </div>


    <div id="battle-planning">
        <h2>Battle Planning</h2>

        <div class="risk-assessment" id="risk-display"></div>

        <div class="battle-info" id="battle-intel"></div>

        <h3 style="color: #ffaa00; font-size: 14px; margin-top: 15px;">Formation</h3>
        <div class="formation-selector">
            <div class="formation-option" data-formation="offensive">
                <div class="formation-name">Offensive</div>
                <div class="formation-effect">+20% ATK, -10% DEF</div>
            </div>
            <div class="formation-option selected" data-formation="balanced">
                <div class="formation-name">Balanced</div>
                <div class="formation-effect">No modifiers</div>
            </div>
            <div class="formation-option" data-formation="defensive">
                <div class="formation-name">Defensive</div>
                <div class="formation-effect">-10% ATK, +20% DEF</div>
            </div>
        </div>

        <div class="retreat-slider">
            <h3 style="color: #ffaa00; font-size: 14px;">Auto-Retreat Threshold</h3>
            <input id="retreat-slider" max="75" min="0" step="25" type="range" value="50">
            <div style="font-size: 12px; text-align: center;">Retreat at <span id="retreat-value">50</span>% casualties
            </div>
        </div>

        <div class="perk-selection" id="perk-selection-container"></div>

        <div class="planning-buttons">
            <button id="scout-btn" onclick="sendScout()">Scout (50 res)</button>
            <button onclick="cancelBattlePlanning()">Cancel</button>
            <button onclick="beginBattle()" style="background: #ff4400; border-color: #ff4400;">ATTACK!</button>
        </div>
    </div>

    <div id="weather-indicator"></div>
    <div id="phase-indicator"></div>

    <div id="army-approaching-notification" style="
    position: fixed;
    top: 120px;
    right: 20px;
    background: rgba(0, 0, 0, 0.95);
    border: 3px solid #ff4400;
    border-radius: 10px;
    padding: 15px 20px;
    z-index: 9999;
    display: none;
    animation: slideInRight 0.5s;
">
        <div style="font-size: 16px; font-weight: bold; color: #ff4400; margin-bottom: 5px;">
            ‚öîÔ∏è <span id="army-notification-text">Army Approaching!</span>
        </div>
        <div style="font-size: 12px; opacity: 0.8;" id="army-notification-detail">
            Target: City Name
        </div>
    </div>

    <div id="peace-demand-popup"
         style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.95); border: 3px solid #ffaa00; border-radius: 15px; padding: 30px; max-width: 600px; z-index: 9998; display: none; text-align: center;">
        <h2 style="color: #ffaa00; margin-bottom: 15px;">Tribal Demand</h2>
        <p id="peace-demand-text" style="font-size: 16px; margin: 20px 0;"></p>
        <p id="peace-demand-consequence" style="font-size: 12px; opacity: 0.8; margin: 15px 0;"></p>
        <p style="font-size: 14px; margin: 20px 0;">Year <span id="peace-talks-year">1</span> of 3</p>
        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 25px;">
            <button onclick="respondToPeaceDemand(true)"
                    style="background: #4CAF50; border-color: #4CAF50; padding: 10px 20px;">Accept
            </button>
            <button onclick="respondToPeaceDemand(false)"
                    style="background: #ff4400; border-color: #ff4400; padding: 10px 20px;">Reject
            </button>
        </div>
    </div>

    <div id="tutorial">
        <h2>Welcome to Equinox Line</h2>
        <p>Manage civilization on a unique planet with a shifting habitable zone!</p>

        <h3>üéØ Victory Conditions:</h3>
        <ul>
            <li><strong>üöÄ Peaceful Evacuation:</strong> Build the Spaceport and complete construction (10 years)</li>
            <li><strong>‚öîÔ∏è Total Domination:</strong> Conquer all tribal cities through military force</li>
            <li><strong>ü§ù Diplomatic Victory:</strong> Maintain 100 reputation with tribals for 10 consecutive years</li>
            <li><strong>üí∞ Economic Supremacy:</strong> Accumulate 50,000 total resources (Food + Metal + Energy)</li>
            <li><em>Note: You can achieve multiple victories - choose which one to claim!</em></li>
        </ul>

        <h3>üåç The Planet & Habitable Zone:</h3>
        <ul>
            <li><strong>The habitable zone MOVES:</strong> Shifts left/right constantly (every ~2 minutes reverses)</li>
            <li><strong>Cities in zone:</strong> Population grows, resources produce normally, happiness rises to 75</li>
            <li><strong>Cities outside zone:</strong> Population dies rapidly, happiness falls to 25, needs food stockpiles</li>
            <li><strong>Hot zone (left/red):</strong> Desert terrain, tribals thrive here</li>
            <li><strong>Cold zone (right/blue):</strong> Ice terrain, harsh conditions</li>
            <li><strong>Strategy tip:</strong> Place cities near zone edges so they stay productive longer</li>
        </ul>

        <h3>üí∞ Resources (FME System):</h3>
        <ul>
            <li><strong>Food (F):</strong> Feeds population, recruits units, trades</li>
            <li><strong>Metal (M):</strong> Builds cities/roads/fortifications, recruits heavy units</li>
            <li><strong>Energy (E):</strong> Powers advanced units/buildings, required for high-tech</li>
            <li><strong>Resource costs shown clearly:</strong> e.g., "200F, 200M, 100E" means 200 Food, 200 Metal, 100 Energy</li>
            <li><strong>Distance penalty:</strong> Building cities far from existing ones costs 1.5x-3x resources!</li>
        </ul>

        <h3>üèôÔ∏è City Management:</h3>
        <ul>
            <li><strong>Placement:</strong> Costs 200F, 200M, 100E base (more if far from cities). Must be 5% apart</li>
            <li><strong>Population:</strong> Grows in habitable zone (0.5/tick base), dies outside zone rapidly</li>
            <li><strong>Max Population:</strong> Your cities: 500 base, tribal cities: 750 max</li>
            <li><strong>Happiness (0-100):</strong> Cities at 0 happiness REBEL and stop producing!</li>
            <li><strong>Rebellion:</strong> Conquered tribal cities rebel for 30 seconds, produce 70% resources</li>
        </ul>

        <h3>üèóÔ∏è City Upgrades:</h3>
        <ul>
            <li><strong>Fortification:</strong>
                <ul>
                    <li>Level 1: 100F, 150M, 50E - Reduces pop death 50% outside zone</li>
                    <li>Level 2: 200F, 300M, 100E - Reduces pop death 75% outside zone</li>
                </ul>
            </li>
            <li><strong>Specializations (choose ONE per city):</strong>
                <ul>
                    <li>‚öîÔ∏è Military Fortress (200F, 250M, 50E): Units 25% cheaper, -20% resources, -10% growth</li>
                    <li>üí∞ Trade Hub (150F, 200M, 50E): +50% resources, units 20% more expensive</li>
                    <li>üî¨ Research Center (200F, 150M, 250E): +20% resources, +30% growth, generates research</li>
                </ul>
            </li>
            <li><strong>Entertainment Districts (max 3 per city):</strong>
                <ul>
                    <li>üé≠ Theater (100F, 150M, 50E): +0.5 happiness/year</li>
                    <li>üèüÔ∏è Arena (150F, 200M, 75E): +0.7 happiness/year</li>
                    <li>üå≥ Public Garden (80F, 100M, 30E): +0.4 happiness/year</li>
                </ul>
            </li>
            <li><strong>Governors (choose ONE per city):</strong>
                <ul>
                    <li>üòä Benevolent (200F, 100M, 50E): +2 happiness/yr, -10% resources</li>
                    <li>‚öîÔ∏è Military (150F, 150M, 75E): +30% defense, -1 happiness/yr</li>
                    <li>üí∞ Economist (250F, 200M, 100E): +25% resources, -10% defense</li>
                    <li>ü§ù Diplomat (200F, 150M, 150E): +1.5 happiness/yr, +10% resources</li>
                </ul>
            </li>
            <li><strong>Emergency Relief (200M, 150E):</strong> Prevents happiness from dropping below 15</li>
        </ul>

        <h3>üçû Food Stockpile System:</h3>
        <ul>
            <li><strong>Each city has food storage (0-100):</strong> Acts as buffer for harsh conditions</li>
            <li><strong>Auto-feed (toggle on/off):</strong> Automatically uses global food to maintain stockpile</li>
            <li><strong>Consumption rate:</strong> Shown in city panel, increases with population and outside zone</li>
            <li><strong>Low stockpile effects:</strong> Below 20 = slower growth, below 10 = happiness penalty</li>
            <li><strong>Empty stockpile:</strong> Population dies MUCH faster outside zone</li>
            <li><strong>Manual food aid:</strong> Send +20 or +50 food directly to cities from global reserves</li>
        </ul>

        <h3>üòä Happiness System (CRITICAL!):</h3>
        <ul>
            <li><strong>Base drift:</strong> In zone ‚Üí rises to 75 | Outside zone ‚Üí falls to 25</li>
            <li><strong>Laws modify it:</strong> Harsh Labor = -2/yr, Relaxed Work = +1/yr, etc.</li>
            <li><strong>Military oppression:</strong> Over 4 units in city = -0.5 happiness/yr per extra unit</li>
            <li><strong>Entertainment districts:</strong> Add +0.4 to +0.7 happiness/yr each</li>
            <li><strong>Road networks:</strong> 2+ connections = +3/yr, 3+ = +5/yr, 4+ = +7/yr, 5+ = +10/yr</li>
            <li><strong>War declaration:</strong> ALL cities lose 25 happiness instantly!</li>
            <li><strong>At 0 happiness:</strong> City enters REBELLION - stops all production!</li>
            <li><strong>Emergency relief:</strong> Prevents happiness from going below 15</li>
        </ul>

        <h3>üõ£Ô∏è Road Networks:</h3>
        <ul>
            <li><strong>Cost:</strong> 100M, 50E base (more for distant cities)</li>
            <li><strong>Bonus per connection:</strong> 1 = +20% resources | 2 = +35% | 3+ = +50%</li>
            <li><strong>Network happiness bonus:</strong> Multiple connections add happiness/year (see above)</li>
            <li><strong>Allied tribal roads:</strong> When allied, you can build roads to tribal cities!</li>
            <li><strong>Road combat bonus:</strong> Armies march 50% FASTER on roads during war</li>
            <li><strong>Road conversion:</strong> Conquer tribal city = road becomes yours automatically</li>
            <li><strong>Road destruction:</strong> If tribals conquer your city, roads to it are destroyed</li>
            <li><strong>Visual indicator:</strong> Cities with 3+ connections show a pulsing green beacon</li>
        </ul>

        <h3>üå≤ Terrain Features (VERY IMPORTANT!):</h3>
        <p><strong>Cities get bonuses from ALL features within range (12% radius):</strong></p>
        <ul>
            <li><strong>üå≥ Sacred Groves:</strong> +15F, +5E - Best food source!</li>
            <li><strong>üíß Lakes:</strong> +10F, +5E - Excellent for food</li>
            <li><strong>üå≤ Forests:</strong> +5F, +3M - Balanced mix</li>
            <li><strong>üåæ Plains:</strong> +4F, +2M, +1 pop/yr - Good for growth</li>
            <li><strong>üå∏ Meadows:</strong> +8F, +1M, +1E, +2 pop/yr - Great all-around</li>
            <li><strong>üçé Orchards:</strong> +10F, +2E, +1 pop/yr - Food focus</li>
            <li><strong>üèîÔ∏è Canyons:</strong> +8M, +2E - Best metal source</li>
            <li><strong>‚õèÔ∏è Mines:</strong> +10M, +3E, -1 pop/yr - Metal rich but harsh</li>
            <li><strong>ü™® Quarries:</strong> +12M, -1 pop/yr - Maximum metal output</li>
            <li><strong>‚ùÑÔ∏è Ice Fields:</strong> +3M, +2E - Cold zone resources</li>
            <li><strong>üèîÔ∏è Glaciers:</strong> +5F, +8E, -2 pop/yr - Energy in cold</li>
            <li><strong>üå®Ô∏è Tundra:</strong> +3F, +4M, +3E, -1 pop/yr - Balanced cold</li>
            <li><strong>üíé Crystal Caves:</strong> +5M, +12E - Best energy source!</li>
            <li><strong>üî• Geothermal Vents:</strong> +5M, +15E - Maximum energy</li>
            <li><strong>üåã Volcanoes:</strong> +15M, +10E, -3 pop/yr - High output, risky</li>
            <li><strong>üèùÔ∏è Oasis:</strong> +12F, +3E, +2 pop/yr - Desert paradise</li>
            <li><strong>üèõÔ∏è Ancient Ruins:</strong> +3F, +8M, +8E - Balanced bonus</li>
            <li><strong>üèúÔ∏è Deserts:</strong> -2 pop/yr - Avoid these!</li>
            <li><strong>‚ö†Ô∏è FEATURE SHARING:</strong> Multiple cities near same feature SPLIT the bonuses!</li>
        </ul>

        <h3>üî¨ Research Tree:</h3>
        <ul>
            <li><strong>Research Points:</strong> Gained slowly over time, faster with Research Centers</li>
            <li><strong>Tech categories:</strong> Military (attack/defense), Agriculture (food/growth), Industry (metal/energy), Infrastructure (buildings/cities)</li>
            <li><strong>Key techs to prioritize:</strong>
                <ul>
                    <li>Basic Farming ‚Üí Irrigation ‚Üí Crop Rotation (food production)</li>
                    <li>Basic Mining ‚Üí Deep Mining (metal production)</li>
                    <li>Basic Housing ‚Üí Apartments (max population)</li>
                    <li>Settlement Planning ‚Üí Urban Planning (cheaper cities)</li>
                </ul>
            </li>
            <li><strong>Tech tree button:</strong> Click "Research" to open full tech tree interface</li>
        </ul>

        <h3>‚öîÔ∏è Military System:</h3>
        <ul>
            <li><strong>Unit Types:</strong>
                <ul>
                    <li>Infantry (5 ATK/3 DEF): 50F, 50M, 0E, 50 pop - Basic troops</li>
                    <li>Cavalry (12 ATK/5 DEF): 100F, 100M, 50E, 100 pop - Fast attackers</li>
                    <li>Artillery (20 ATK/2 DEF): 50F, 300M, 150E, 10 pop - Glass cannons</li>
                </ul>
            </li>
            <li><strong>Recruiting:</strong> Select city first, then recruit (max 8 units per city)</li>
            <li><strong>Stationing:</strong> Units stay in cities for defense or can attack tribals</li>
            <li><strong>Transfer units:</strong> Move units between cities via "Transfer Units" button</li>
            <li><strong>Tribal alarm:</strong> Building 11+ of any unit type costs -10 tribal reputation</li>
        </ul>

        <h3>üéØ NEW Combat System - Real-Time Tactical Battles:</h3>
        <ul>
            <li><strong>Battle Planning Screen:</strong>
                <ul>
                    <li>Shows power ratio, distance penalty, morale modifier, risk assessment</li>
                    <li>Choose formation: Offensive (+20% ATK/-10% DEF), Balanced, Defensive (-10% ATK/+20% DEF)</li>
                    <li>Set retreat threshold: 0%, 25%, 50%, 75% casualties to auto-retreat</li>
                    <li>Scout enemy (50 res) to reveal exact forces before battle</li>
                    <li>Select Commander Perks (unlock by winning battles)</li>
                    <li>Multi-city attacks: Select multiple cities to combine forces!</li>
                </ul>
            </li>
            <li><strong>March Phase (NEW!):</strong>
                <ul>
                    <li>Armies visually march across the map - watch them move!</li>
                    <li>Base march time: ~1 game year minimum</li>
                    <li>Larger armies march SLOWER: +15% time per unit</li>
                    <li>Road bonus: Armies on allied roads march 50% FASTER!</li>
                    <li>Distance matters: Farther targets = longer marches</li>
                    <li>Battle doesn't start until armies arrive at target</li>
                </ul>
            </li>
            <li><strong>Real-Time Battle Controls:</strong>
                <ul>
                    <li>Give orders to each unit type independently</li>
                    <li>‚¨ÜÔ∏è Advance: +30% ATK, -20% DEF - Push forward aggressively</li>
                    <li>üõ°Ô∏è Hold: +40% DEF, -10% ATK - Defend your position</li>
                    <li>üéØ Focus Fire: +50% ATK, -40% DEF - All-out attack, risky!</li>
                    <li>Priority targeting: Choose which enemy units to focus</li>
                    <li>Weather effects: Fog (late visibility), Sandstorm (units vanish), Frost (slowed)</li>
                </ul>
            </li>
            <li><strong>Battle Phases:</strong>
                <ul>
                    <li>Phase 1: Initial engagement (0-20 seconds)</li>
                    <li>Phase 2: Frontline clash (20-50 seconds)</li>
                    <li>Phase 3: Desperate struggle (50-90 seconds)</li>
                    <li>Each phase gets more intense!</li>
                </ul>
            </li>
            <li><strong>Morale System:</strong>
                <ul>
                    <li>Based on average city happiness (0-100)</li>
                    <li>High morale = more damage dealt</li>
                    <li>Losing combo or taking damage reduces morale</li>
                    <li>Commander perk "Inspiration" boosts damage at high morale</li>
                </ul>
            </li>
            <li><strong>Commander Perks (Unlock by Winning):</strong>
                <ul>
                    <li>Level 1: Veteran Troops - Start with +2 combo, +20% HP</li>
                    <li>Level 2: Swift Strike - Activate to double attack speed for 10s</li>
                    <li>Level 3: Defensive Genius - Take 25% less damage</li>
                    <li>Level 4: Relentless - First miss doesn't break combo</li>
                    <li>Level 5: Inspiration - High morale boosts damage by 15%</li>
                </ul>
            </li>
            <li><strong>Reinforcements:</strong>
                <ul>
                    <li>Call during battle if connected to supply lines (300 res)</li>
                    <li>Adds +2 Infantry, +1 Cavalry instantly</li>
                    <li>Only works if you have connected cities nearby</li>
                </ul>
            </li>
            <li><strong>Casualties & Retreat:</strong>
                <ul>
                    <li>Both sides lose units based on damage dealt</li>
                    <li>Survivors return to your cities (distributed among attackers)</li>
                    <li>Auto-retreat saves units when threshold reached</li>
                    <li>Total defeat = lose all attacking forces</li>
                </ul>
            </li>
            <li><strong>Tribal Reinforcements (NEW!):</strong>
                <ul>
                    <li>Nearby tribal cities (within 25%) send reinforcements!</li>
                    <li>Up to 2 infantry, 1 cavalry, 1 artillery per ally</li>
                    <li>Max 8 units per tribal city (capacity limit)</li>
                    <li>Makes isolated attacks easier than hitting tribal clusters</li>
                </ul>
            </li>
        </ul>

        <h3>üë• Tribal Diplomacy (COMPLEX!):</h3>
        <ul>
            <li><strong>Reputation scale (0-100):</strong>
                <ul>
                    <li>0-20: WAR - Tribes attack your cities!</li>
                    <li>21-40: Hostile - Unfriendly, won't trade</li>
                    <li>41-60: Neutral - Trade available</li>
                    <li>61-80: Friendly - Better trade deals</li>
                    <li>81-100: Allied - Can build roads to tribal cities, achieve Diplomatic Victory</li>
                </ul>
            </li>
            <li><strong>Actions & Effects:</strong>
                <ul>
                    <li>Trade (80F ‚Üí 80M): +10 rep, 10-year cooldown</li>
                    <li>Embassy (200F, 200M, 100E): +20 rep, one-time</li>
                    <li>Build roads to tribals: Only when allied, gives march speed bonus in war</li>
                    <li>Denounce: -30 rep</li>
                    <li>Declare War: Set rep to 0, all cities lose 25 happiness</li>
                    <li>Building too close (within 10%): -10 rep per city</li>
                    <li>Military buildup (11+ units): -10 rep per unit type</li>
                </ul>
            </li>
            <li><strong>‚ö†Ô∏è TRIBAL INVASION TRIGGER:</strong>
                <ul>
                    <li>If tribals have 50+ total troops AND</li>
                    <li>Your rep < 50 AND</li>
                    <li>You have 3+ cities near tribal territory (within 30%) AND</li>
                    <li>No peace treaty active...</li>
                    <li>‚Üí They declare WAR and launch coordinated attacks!</li>
                </ul>
            </li>
            <li><strong>Peace Negotiations:</strong>
                <ul>
                    <li>Costs 1000 resources to initiate during war</li>
                    <li>Tribals make 3 demands over 3 years (accept or reject each)</li>
                    <li>Demands: Surrender city, disband 30% military, pay 500 tribute, lose happiness</li>
                    <li>Meeting 0 demands = massive attack! 1 = hostile, 2 = neutral, 3 = friendly</li>
                    <li>Peace treaty = 7-year protection from war</li>
                </ul>
            </li>
        </ul>

        <h3>üèõÔ∏è Tribal Behavior:</h3>
        <ul>
            <li><strong>Expansion:</strong> Build roads every 10 years, new cities every 30-40 years</li>
            <li><strong>Population:</strong> Grows slowly (+0.2/tick), max 750 per city</li>
            <li><strong>Military recruitment:</strong>
                <ul>
                    <li>Peacetime: 0.3% chance/tick (max 3 recruits/year)</li>
                    <li>Wartime: 0.9% chance/tick (max 12 recruits/year)</li>
                </ul>
            </li>
            <li><strong>Force positioning:</strong> Moves units to frontline cities near your borders</li>
            <li><strong>Reinforcements:</strong> Nearby tribal cities (within 25%) send troops to defend attacked cities</li>
            <li><strong>Counterattacks:</strong> During war, randomly attack your weakest cities</li>
            <li><strong>Max capacity:</strong> 8 units per tribal city (like your cities)</li>
        </ul>

        <h3>üèõÔ∏è Wonders of the World:</h3>
        <ul>
            <li><strong>Build powerful wonders near your cities for huge bonuses</strong></li>
            <li><strong>Must be connected by road to work!</strong> Disconnected wonders are inactive</li>
            <li><strong>Available Wonders:</strong>
                <ul>
                    <li>üìö Great Library: Doubles research point generation</li>
                    <li>üõ°Ô∏è Planetary Defense Grid: +25% defense to all cities</li>
                    <li>üóÇÔ∏è Grand Archive: Reveals all tribal forces permanently</li>
                    <li>üóø Monument of Unity: +15 happiness/year to all cities</li>
                    <li>üè≠ Mega Factory: +30% metal and energy production</li>
                    <li>üå∫ Garden of Life: +40% food, +20% population growth</li>
                    <li>‚≠ê Supreme Command: +20% unit attack, units cost 20% less</li>
                    <li>üåü Cosmic Beacon: Spaceport construction 50% faster</li>
                </ul>
            </li>
        </ul>

        <h3>‚öñÔ∏è City Laws (Global Effect):</h3>
        <ul>
            <li><strong>No Special Laws:</strong> Baseline (0% resources, 0 happiness)</li>
            <li><strong>Relaxed Work:</strong> -20% resources, +1 happiness/yr</li>
            <li><strong>Efficiency Standards:</strong> +30% resources, -0.5 happiness/yr</li>
            <li><strong>Increased Production:</strong> +50% resources, -1 happiness/yr</li>
            <li><strong>Harsh Labor Laws:</strong> +100% resources, -2 happiness/yr - Risky but powerful!</li>
        </ul>

        <h3>üéÅ Philanthropy:</h3>
        <ul>
            <li><strong>Small Aid (30F, 15M, 5E):</strong> +5 happiness to ALL cities</li>
            <li><strong>Medium Aid (90F, 45M, 15E):</strong> +15 happiness to ALL cities</li>
            <li><strong>Large Aid (240F, 120M, 40E):</strong> +35 happiness to ALL cities</li>
            <li><strong>Use this to prevent rebellions or boost morale before war!</strong></li>
        </ul>

        <h3>üöÄ Spaceport Victory Path:</h3>
        <ul>
            <li><strong>Requirements to start:</strong> 5000 population AND 4000F + 4000M + 4000E</li>
            <li><strong>Construction time:</strong> 10 years (real-time: ~16 minutes)</li>
            <li><strong>‚ö†Ô∏è Population must stay above 3500 during construction or project FAILS!</strong></li>
            <li><strong>Resources spent upfront:</strong> 4000F, 4000M, 4000E consumed when starting</li>
            <li><strong>Track progress:</strong> Click "Spaceport" button to see % completion</li>
        </ul>

        <h3>üéÆ Controls & UI:</h3>
        <ul>
            <li><strong>ESC:</strong> Cancel placement/close panels</li>
            <li><strong>Click city:</strong> View info, recruit units, upgrade</li>
            <li><strong>Click tribal:</strong> View info, attack if at war, build roads if allied</li>
            <li><strong>Drag map:</strong> Pan around the planet</li>
            <li><strong>Mouse wheel:</strong> Zoom in/out</li>
            <li><strong>+/- buttons:</strong> Zoom controls (bottom right)</li>
            <li><strong>Minimap:</strong> Click to jump to location (top left), shows marching armies</li>
            <li><strong>üîä Button:</strong> Toggle music (bottom right)</li>
            <li><strong>Victory button:</strong> Check progress toward all victory conditions</li>
            <li><strong>Research button:</strong> Open tech tree</li>
            <li><strong>Wonders button:</strong> Build world wonders</li>
        </ul>

        <h3>üí° Pro Strategy Tips:</h3>
        <ul>
            <li><strong>Early game:</strong> Build near Sacred Groves/Lakes for food, focus on population growth</li>
            <li><strong>Mid game:</strong> Connect cities with roads ASAP, specialize cities based on nearby features</li>
            <li><strong>Late game:</strong> Balance 3 resources for Spaceport, or build military for domination</li>
            <li><strong>Zone strategy:</strong> Build cities at 45-55% to maximize time in habitable zone</li>
            <li><strong>Food stockpiles:</strong> Keep cities near zone edges at 80-100 food for safety</li>
            <li><strong>Tribal management:</strong> Stay allied (80+ rep) to build roads for tactical advantage</li>
            <li><strong>Military timing:</strong> Don't build 11+ units until ready to fight!</li>
            <li><strong>March planning:</strong> Smaller armies march faster - consider multiple waves</li>
            <li><strong>Road warfare:</strong> Build allied roads to tribal territory before war for speed bonus</li>
            <li><strong>Multi-city attacks:</strong> Coordinate attacks from multiple cities for overwhelming force</li>
            <li><strong>Happiness crisis:</strong> Use Philanthropy + Relaxed Work law to prevent rebellions</li>
            <li><strong>Feature sharing:</strong> Spread cities out - don't cluster around same features</li>
            <li><strong>Defense:</strong> Station 2-4 units in vulnerable cities (more causes unhappiness)</li>
            <li><strong>Commander XP:</strong> Win battles to unlock powerful combat perks</li>
            <li><strong>Wonder synergy:</strong> Supreme Command + Military cities = unstoppable army</li>
            <li><strong>Multiple victories:</strong> You can complete all 4 - choose your favorite to claim!</li>
        </ul>

        <h3>‚ö†Ô∏è Common Mistakes to Avoid:</h3>
        <ul>
            <li>Building all cities in one zone (zone will shift away!)</li>
            <li>Ignoring happiness (leads to rebellions)</li>
            <li>Building too close to tribals early (angers them)</li>
            <li>Not connecting cities with roads (miss huge bonuses)</li>
            <li>Not building allied roads before declaring war (miss speed bonus)</li>
            <li>Sending entire army in one march (slower + higher risk)</li>
            <li>Attacking tribal clusters without scouting reinforcements</li>
            <li>Letting food stockpiles hit zero outside habitable zone</li>
            <li>Over-garrisoning cities (causes happiness penalties)</li>
            <li>Starting Spaceport construction without stable 3500+ population</li>
            <li>Declaring war without adequate military preparation</li>
            <li>Building wonders without connecting them to road networks</li>
        </ul>

        <button onclick="startGame()" style="width: 100%; margin-top: 20px; padding: 12px; font-size: 14px;">Start Game</button>
    </div>


    <div id="game-over">
        <h2>Civilization Collapsed</h2>
        <p id="game-over-msg"></p>
        <button onclick="location.reload()" style="margin-top: 20px;">Play Again</button>
    </div>
</div>

<script src="game.js">
</script>
</body>
</html>